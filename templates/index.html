<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Графік відключень світла</title>

<style>
:root {
  --bg: #0b1e26;
  --panel: #102b36;
  --hour: #12323f;
  --off: #4b5d66;
  --text: #e5f2f7;
  --muted: #9fb9c5;
  --accent: #1e90ff;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
}

.container {
  max-width: 1000px;
  margin: auto;
  padding: 16px;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

h3 {
  color: var(--muted);
  margin: 30px 0 12px;
  font-size: 20px;
}

/* ===== Select ===== */
.select-wrapper {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

select {
  background: var(--panel);
  color: var(--text);
  border: 1px solid var(--hour);
  border-radius: 10px;
  padding: 12px 16px;
  font-size: 16px;
  width: 100%;
  max-width: 260px;
  appearance: none;
  text-align: center;
}

/* ===== Timer ===== */
.timer-box {
  max-width: 320px;
  margin: 20px auto;
  padding: 14px;
  background: var(--panel);
  border-radius: 14px;
  text-align: center;
}

.timer-title {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 6px;
}

.timer {
  font-size: 28px;
  font-weight: bold;
}

/* ===== Timeline ===== */
.timeline-wrapper {
  overflow-x: auto;
}

.timeline {
  display: grid;
  grid-template-columns: repeat(24, minmax(36px, 1fr));
  gap: 3px;
  min-width: 720px;
}

.hour {
  height: 38px;
  background: var(--hour);
  border-radius: 4px;
  position: relative;
}

.hour.off {
  background: var(--off);
}

.hour::after {
  content: attr(data-hour);
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 10px;
  color: var(--muted);
}

.now {
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 7px;
  height: 7px;
  background: var(--accent);
  border-radius: 50%;
}

/* ===== Mobile ===== */
@media (max-width: 480px) {
  h2 {
    font-size: 20px;
  }

  h3 {
    font-size: 18px;
  }

  .timer {
    font-size: 24px;
  }
}
</style>
</head>

<body>

<div class="container">

<h2>Олександрійський район — графік світла</h2>

<div class="select-wrapper">
<select id="queue">
  <option>1.1</option><option>1.2</option>
  <option>2.1</option><option>2.2</option>
  <option>3.1</option><option>3.2</option>
  <option>4.1</option><option>4.2</option>
  <option>5.1</option><option>5.2</option>
  <option>6.1</option><option>6.2</option>
</select>
</div>

<div class="timer-box">
  <div class="timer-title" id="timerTitle">До вимкнення світла</div>
  <div class="timer" id="timer">--:--:--</div>
</div>

<h3>Сьогодні</h3>
<div class="timeline-wrapper">
  <div class="timeline" id="timeline_today"></div>
</div>

<h3 id="tomorrowTitle" style="display:none">Завтра</h3>
<div class="timeline-wrapper">
  <div class="timeline" id="timeline_tomorrow"></div>
</div>

</div>

<script>
const queueSelect = document.getElementById("queue");
const timer = document.getElementById("timer");
const timerTitle = document.getElementById("timerTitle");
const todayTimeline = document.getElementById("timeline_today");
const tomorrowTimeline = document.getElementById("timeline_tomorrow");
const tomorrowTitle = document.getElementById("tomorrowTitle");

queueSelect.value = localStorage.getItem("queue") || "1.1";

function drawTimeline(el, ranges=[]) {
  el.innerHTML = "";
  const now = new Date().getHours();

  for (let h = 0; h < 24; h++) {
    const d = document.createElement("div");
    d.className = "hour";
    d.dataset.hour = String(h).padStart(2,"0");

    ranges.forEach(([s,e]) => {
      if (h >= s && h < e) d.classList.add("off");
    });

    if (h === now) {
      const dot = document.createElement("div");
      dot.className = "now";
      d.appendChild(dot);
    }

    el.appendChild(d);
  }
}

async function load(queue) {
  localStorage.setItem("queue", queue);

  const today = await fetch(`/api/schedule?queue=${queue}&date=today`).then(r=>r.json());
  drawTimeline(todayTimeline, today.ranges || []);

  const tomorrow = await fetch(`/api/schedule?queue=${queue}&date=tomorrow`).then(r=>r.json());
  if (tomorrow.ranges?.length) {
    tomorrowTitle.style.display = "block";
    drawTimeline(tomorrowTimeline, tomorrow.ranges);
  } else {
    tomorrowTitle.style.display = "none";
    tomorrowTimeline.innerHTML = "";
  }
}

queueSelect.onchange = () => load(queueSelect.value);
load(queueSelect.value);
</script>

</body>
</html>
